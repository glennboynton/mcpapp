{# app/templates/api_admin/integrations.html #}
{% extends 'base.html' %}
{% block title %}API Integrations{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>All API Integrations</h2>
  <a
    href="{{ url_for('api_admin.create_integration') }}"
    class="btn btn-success"
    >New Integration</a
  >
</div>
<table class="table table-hover">
  <thead>
    <tr>
      <th>Name</th>
      <th>System</th>
      <th>Status</th>
      <th>Owner</th>
      <th>Docs</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for i in integrations %}
    <tr>
      <td>{{ i.name }}</td>
      <td>{{ i.system_name }}</td>
      <td>
        <span
          class="badge bg-{% if i.status == 'enabled' %}success{% elif i.status == 'disabled' %}secondary{% else %}danger{% endif %}"
        >
          {{ i.status }}
        </span>
      </td>
      <td>{{ i.owner.full_name }}</td>
      <td>
        {% if doc_links[i.id] %}
        <a href="{{ doc_links[i.id] }}" target="_blank">Docs</a>
        {% else %}
        <span class="text-muted">None</span>
        {% endif %}
      </td>
      <td>
        <a
          href="{{ url_for('api_admin.edit_integration', integration_id=i.id) }}"
          class="btn btn-sm btn-primary"
          >Edit</a
        >
        <form
          method="post"
          action="{{ url_for('api_admin.delete_integration', integration_id=i.id) }}"
          class="d-inline"
        >
          <button
            type="submit"
            class="btn btn-sm btn-outline-danger"
            onclick="return confirm('Delete this integration?');"
          >
            Delete
          </button>
        </form>
        <form
          method="post"
          action="{{ url_for('api_admin.toggle_integration_status', integration_id=i.id) }}"
          class="d-inline"
        >
          <button type="submit" class="btn btn-sm btn-outline-secondary">
            Toggle
          </button>
        </form>
        <form
          method="post"
          action="{{ url_for('api_admin.test_integration', integration_id=i.id) }}"
          class="d-inline"
        >
          <button type="submit" class="btn btn-sm btn-outline-info">
            Test
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
